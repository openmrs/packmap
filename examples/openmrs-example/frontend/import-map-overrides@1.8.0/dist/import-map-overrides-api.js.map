{"version":3,"file":"import-map-overrides-api.js","sources":["../src/api/js-api.js"],"sourcesContent":["const localStoragePrefix = \"import-map-override:\";\n\nconst portRegex = /^\\d+$/g;\n\nwindow.importMapOverrides = {\n  addOverride(moduleName, url) {\n    if (portRegex.test(url)) {\n      url = window.importMapOverrides.getUrlFromPort(moduleName, url);\n    }\n    const key = localStoragePrefix + moduleName;\n    localStorage.setItem(key, url);\n    fireChangedEvent();\n    return window.importMapOverrides.getOverrideMap();\n  },\n  getOverrideMap() {\n    const overrides = { imports: {} };\n    for (let i = 0; i < localStorage.length; i++) {\n      const key = localStorage.key(i);\n      if (key.startsWith(localStoragePrefix)) {\n        overrides.imports[\n          key.slice(localStoragePrefix.length)\n        ] = localStorage.getItem(key);\n      }\n    }\n\n    return overrides;\n  },\n  removeOverride(moduleName) {\n    const key = localStoragePrefix + moduleName;\n    const hasItem = localStorage.getItem(key) !== null;\n    localStorage.removeItem(key);\n    fireChangedEvent();\n    return hasItem;\n  },\n  resetOverrides() {\n    Object.keys(window.importMapOverrides.getOverrideMap().imports).forEach(\n      moduleName => {\n        window.importMapOverrides.removeOverride(moduleName);\n      }\n    );\n    fireChangedEvent();\n    return window.importMapOverrides.getOverrideMap();\n  },\n  hasOverrides() {\n    return (\n      Object.keys(window.importMapOverrides.getOverrideMap().imports).length > 0\n    );\n  },\n  getUrlFromPort(moduleName, port) {\n    const fileName = moduleName.replace(/@/g, \"\").replace(/\\//g, \"-\");\n    return `//localhost:${port}/${fileName}.js`;\n  }\n};\n\nfunction fireChangedEvent() {\n  // Set timeout so that event fires after the change has totally finished\n  setTimeout(() => {\n    if (window.CustomEvent) {\n      window.dispatchEvent(new CustomEvent(\"import-map-overrides:change\"));\n    }\n  });\n}\n\nconst overrideMap = window.importMapOverrides.getOverrideMap();\nconst importMapMetaElement = document.querySelector(\n  'meta[name=\"importmap-type\"]'\n);\nexport const importMapType = importMapMetaElement\n  ? importMapMetaElement.getAttribute(\"content\")\n  : \"import-map\";\n\nif (Object.keys(overrideMap.imports).length > 0) {\n  const overrideMapElement = document.createElement(\"script\");\n  overrideMapElement.type = importMapType;\n  overrideMapElement.id = \"import-map-overrides\"; // for debugging and for UI to identify this import map as special\n  overrideMapElement.innerHTML = JSON.stringify(overrideMap);\n\n  const importMaps = document.querySelectorAll(\n    `script[type=\"${importMapType}\"]`\n  );\n  if (importMaps.length > 0) {\n    importMaps[importMaps.length - 1].insertAdjacentElement(\n      \"afterend\",\n      overrideMapElement\n    );\n  } else {\n    document.head.appendChild(overrideMapElement);\n  }\n}\n"],"names":["portRegex","fireChangedEvent","setTimeout","window","CustomEvent","dispatchEvent","importMapOverrides","addOverride","moduleName","url","test","getUrlFromPort","key","localStorage","setItem","getOverrideMap","overrides","imports","i","length","startsWith","slice","localStoragePrefix","getItem","removeOverride","hasItem","removeItem","resetOverrides","Object","keys","forEach","hasOverrides","port","fileName","replace","overrideMap","importMapMetaElement","document","querySelector","importMapType","getAttribute","overrideMapElement","createElement","type","id","innerHTML","JSON","stringify","importMaps","querySelectorAll","insertAdjacentElement","head","appendChild"],"mappings":"yBAAA,IAEMA,EAAY,SAoDlB,SAASC,IAEPC,WAAW,WACLC,OAAOC,aACTD,OAAOE,cAAc,IAAID,YAAY,kCAtD3CD,OAAOG,mBAAqB,CAC1BC,qBAAYC,EAAYC,GAClBT,EAAUU,KAAKD,KACjBA,EAAMN,OAAOG,mBAAmBK,eAAeH,EAAYC,QAEvDG,EATiB,uBASUJ,SACjCK,aAAaC,QAAQF,EAAKH,GAC1BR,IACOE,OAAOG,mBAAmBS,kBAEnCA,kCACQC,EAAY,CAAEC,QAAS,IACpBC,EAAI,EAAGA,EAAIL,aAAaM,OAAQD,IAAK,KACtCN,EAAMC,aAAaD,IAAIM,GACzBN,EAAIQ,WAlBa,0BAmBnBJ,EAAUC,QACRL,EAAIS,MAAMC,KACRT,aAAaU,QAAQX,WAItBI,GAETQ,wBAAehB,OACPI,EA5BiB,uBA4BUJ,EAC3BiB,EAAwC,OAA9BZ,aAAaU,QAAQX,UACrCC,aAAaa,WAAWd,GACxBX,IACOwB,GAETE,iCACEC,OAAOC,KAAK1B,OAAOG,mBAAmBS,iBAAiBE,SAASa,QAC9D,SAAAtB,GACEL,OAAOG,mBAAmBkB,eAAehB,KAG7CP,IACOE,OAAOG,mBAAmBS,kBAEnCgB,+BAEIH,OAAOC,KAAK1B,OAAOG,mBAAmBS,iBAAiBE,SAASE,OAAS,GAG7ER,wBAAeH,EAAYwB,OACnBC,EAAWzB,EAAW0B,QAAQ,KAAM,IAAIA,QAAQ,MAAO,iCACvCF,cAAQC,WAalC,IAAME,EAAchC,OAAOG,mBAAmBS,iBACxCqB,EAAuBC,SAASC,cACpC,+BAEWC,EAAgBH,EACzBA,EAAqBI,aAAa,WAClC,aAEJ,GAAIZ,OAAOC,KAAKM,EAAYlB,SAASE,OAAS,EAAG,KACzCsB,EAAqBJ,SAASK,cAAc,UAClDD,EAAmBE,KAAOJ,EAC1BE,EAAmBG,GAAK,uBACxBH,EAAmBI,UAAYC,KAAKC,UAAUZ,OAExCa,EAAaX,SAASY,wCACVV,SAEdS,EAAW7B,OAAS,EACtB6B,EAAWA,EAAW7B,OAAS,GAAG+B,sBAChC,WACAT,GAGFJ,SAASc,KAAKC,YAAYX"}